---
id: i3r5y
name: Error reporting in git
file_version: 1.1.0
app_version: 1.0.0
file_blobs:
  daemon.c: 5c4cbad62d0caa723a874392097512a0df5933cd
  branch.c: 7a88a4861e7eb41e5415f141d4d143170c8ca5e0
  usage.c: c7d233b0de9538951c5f3d47aa165d900034c02b
  parse-options.c: 2abff136a17b1d37452695f8b06609a3176fa273
---

`BUG`<swm-token data-swm-token=":usage.c:295:4:4:`NORETURN void BUG(const char *fmt, ...)`"/>, `die`<swm-token data-swm-token=":usage.c:160:4:4:`void NORETURN die(const char *err, ...)`"/>, `usage`<swm-token data-swm-token=":usage.c:155:4:4:`void NORETURN usage(const char *err)`"/>, `error`<swm-token data-swm-token=":usage.c:227:2:2:`int error(const char *err, ...)`"/>, and `warning`<swm-token data-swm-token=":usage.c:247:2:2:`void warning(const char *warn, ...)`"/> report errors of various kinds.

\- `BUG` is for failed internal assertions that should never happen, i.e. a bug in git itself.

\- `die` is for fatal application errors. It prints a message to the user and exits with status 128.

\- `usage` is for errors in command line usage. After printing its message, (See also `usage_with_options`<swm-token data-swm-token=":parse-options.c:1002:4:4:`void NORETURN usage_with_options(const char * const *usagestr,`"/>)

\- `error` is for non-fatal library errors. It prints a message to the user and returns -1 for convenience in signaling the error

to the caller.

\- `warning` is for reporting situations that probably should not occur but which the user (and Git) can continue to work around

without running into too many problems. Like `error`, it returns -1 after reporting the situation to the caller.

<br/>

## Customizable error handlers

The default behavior of `die` and `error` is to write a message to stderr and then exit or return as appropriate. This behavior can be

overridden using `set_die_routine` and `set_error_routine`.

<br/>

<br/>

For example, "git daemon" uses `set_die_routine`<swm-token data-swm-token=":daemon.c:1436:1:1:`		set_die_routine(daemon_die);`"/> to write the reason `die`<swm-token data-swm-token=":usage.c:160:4:4:`void NORETURN die(const char *err, ...)`"/> was called to syslog before exiting.
<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### 游늯 daemon.c
```c
游릴 1434   	if (log_destination == LOG_DESTINATION_SYSLOG) {
游릴 1435   		openlog("git-daemon", LOG_PID, LOG_DAEMON);
游릴 1436   		set_die_routine(daemon_die);
游릴 1437   	} else
```

<br/>

# Caller-handled errors

An increasing number of functions take a parameter `struct strbuf *err`.

<br/>

<br/>

On error, such functions append a message about what went wrong to the `err` strbuf. The message is meant to be complete enough to be passed to `die` or `error` as-is. For example:
<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### 游늯 branch.c
```c
游릴 323    		if (!transaction ||
游릴 324    		    ref_transaction_update(transaction, ref.buf,
游릴 325    					   &oid, forcing ? NULL : null_oid(),
游릴 326    					   0, msg, &err) ||
游릴 327    		    ref_transaction_commit(transaction, &err))
游릴 328    			die("%s", err.buf);
```

<br/>

<br/>

<br/>

The 'err' parameter will be untouched if no error occurred, so multiple function calls can be chained:
<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### 游늯 branch.c
```c
游릴 322    		transaction = ref_transaction_begin(&err);
游릴 323    		if (!transaction ||
游릴 324    		    ref_transaction_update(transaction, ref.buf,
游릴 325    					   &oid, forcing ? NULL : null_oid(),
游릴 326    					   0, msg, &err) ||
游릴 327    		    ref_transaction_commit(transaction, &err))
游릴 328    			die("%s", err.buf);
游릴 329    		ref_transaction_free(transaction);
游릴 330    		strbuf_release(&err);
```

<br/>

<br/>

<br/>

<br/>

This file was generated by Swimm. [Click here to view it in the app](https://app.swimm.io/repos/Z2l0aHViJTNBJTNBZ2l0LXNyYy1wbGF5Z3JvdW5kJTNBJTNBT21lclJvc2VuYmF1bQ==/docs/i3r5y).
